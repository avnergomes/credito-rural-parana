<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Dashboard de Credito Rural do Parana - Dados BCB/SICOR" />
    <meta name="theme-color" content="#2563eb" />

    <!-- Open Graph -->
    <meta property="og:title" content="Credito Rural Parana" />
    <meta property="og:description" content="Dashboard interativo de financiamento agropecuario do Parana" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/assets/og-image.png" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <title>Credito Rural Parana - BCB/SICOR</title>

    <!-- Tracking LGPD-compliant (19 campos anonimos) -->
    <script>
      (function() {
        function hasLGPDConsent() {
          return localStorage.getItem('lgpd-consent') === 'accepted';
        }

        var SCRIPT_URL = '%VITE_TRACKING_URL%';
        // Skip if URL not configured
        if (!SCRIPT_URL || SCRIPT_URL.indexOf('VITE_TRACKING_URL') !== -1) {
          console.warn('[Tracking] URL not configured');
          return;
        }

        function getDeviceType() {
          var ua = navigator.userAgent;
          if (/tablet|ipad|playbook|silk/i.test(ua)) return 'Tablet';
          if (/Mobile|Android|iPhone|iPod|webOS|BlackBerry|Opera Mini|IEMobile/i.test(ua)) return 'Mobile';
          return 'Desktop';
        }

        function getConnectionType() {
          if (navigator.connection) {
            return navigator.connection.effectiveType || 'unknown';
          }
          return 'unknown';
        }

        function getUTMParams() {
          var params = new URLSearchParams(window.location.search);
          return {
            utmSource: params.get('utm_source') || '',
            utmMedium: params.get('utm_medium') || '',
            utmCampaign: params.get('utm_campaign') || '',
            utmTerm: params.get('utm_term') || '',
            utmContent: params.get('utm_content') || ''
          };
        }

        function initTracking() {
          var loadTime = 0;
          // Navigation Timing Level 2 API (replaces deprecated performance.timing)
          var navEntry = window.performance && window.performance.getEntriesByType ? window.performance.getEntriesByType('navigation')[0] : null;
          if (navEntry) {
            loadTime = Math.round(navEntry.loadEventEnd);
          }

          var utmParams = getUTMParams();

          var data = {
            origin: window.location.origin,
            timestamp: new Date().toISOString(),
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            timezoneOffset: new Date().getTimezoneOffset(),
            page: window.location.href,
            pathname: window.location.pathname,
            referrer: document.referrer || '',
            pageTitle: document.title,
            language: navigator.language,
            deviceType: getDeviceType(),
            screenOrientation: screen.orientation ? screen.orientation.type : 'unknown',
            connectionType: getConnectionType(),
            loadTime: loadTime > 0 ? loadTime : '',
            utmSource: utmParams.utmSource,
            utmMedium: utmParams.utmMedium,
            utmCampaign: utmParams.utmCampaign,
            utmTerm: utmParams.utmTerm,
            utmContent: utmParams.utmContent,
            prefersColorScheme: window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
          };

          fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          }).then(function() {
            console.log('[Tracking] Data sent');
          }).catch(function(err) {
            console.log('[Tracking] Error:', err);
          });
        }

        window.initTracking = initTracking;

        // Only track if user consented
        if (hasLGPDConsent()) {
          if (document.readyState === 'complete') {
            setTimeout(initTracking, 100);
          } else {
            window.addEventListener('load', function() { setTimeout(initTracking, 100); });
          }
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

<!-- LGPD Consent Banner -->
<div id="lgpd-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#1e293b; color:#e2e8f0; padding:1rem 1.5rem; z-index:9999; font-family:system-ui,sans-serif; font-size:0.875rem; box-shadow:0 -2px 10px rgba(0,0,0,0.2);">
  <div style="max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
    <p style="margin:0; flex:1; min-width:280px; line-height:1.5;">
      Este site utiliza cookies e tecnologias para melhorar sua experiencia.
      Ao clicar em "Aceitar", voce concorda com a coleta de dados conforme a
      <a href="https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm" target="_blank" rel="noopener" style="color:#60a5fa; text-decoration:underline;">LGPD</a>.
    </p>
    <div style="display:flex; gap:0.5rem; flex-shrink:0;">
      <button onclick="document.getElementById('lgpd-banner').style.display='none'; localStorage.setItem('lgpd-consent','rejected');"
        style="padding:0.5rem 1rem; border:1px solid #475569; border-radius:6px; background:transparent; color:#e2e8f0; cursor:pointer; font-size:0.8rem;">
        Recusar
      </button>
      <button onclick="document.getElementById('lgpd-banner').style.display='none'; localStorage.setItem('lgpd-consent','accepted'); if(typeof initTracking==='function') initTracking();"
        style="padding:0.5rem 1rem; border:none; border-radius:6px; background:#3b82f6; color:white; cursor:pointer; font-size:0.8rem; font-weight:500;">
        Aceitar
      </button>
    </div>
  </div>
</div>
<script>
  if (!localStorage.getItem('lgpd-consent')) {
    document.getElementById('lgpd-banner').style.display = 'block';
  }
</script>
  </body>
</html>
